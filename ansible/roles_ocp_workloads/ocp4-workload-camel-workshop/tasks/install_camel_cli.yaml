- name: Install and configure Apache Camel CLI (with retries)
  ansible.builtin.shell: >-
    curl -Ls https://sh.jbang.dev | bash -s - app setup && \
    {{ cli_jbang }} trust add https://github.com/apache/camel/ && \
    {{ cli_jbang }} app install -Dcamel.jbang.version=4.15.0 camel@apache/camel && \
    {{ cli_jbang }} camel@apache/camel plugin add kubernetes && \
    {{ cli_camel }} version
  args:
    executable: /bin/bash
  register: camel_install
  until: camel_install.rc == 0
  retries: 10              # try up to 10 times
  delay: 600               # wait [delay] seconds between retries
  changed_when: camel_install.rc == 0
  failed_when: camel_install.rc != 0
  ignore_errors: false     # keep false â€“ we really want it to succeed


- name: Show test Camel CLI
  debug:
    msg: "{{ camel_install }}"
