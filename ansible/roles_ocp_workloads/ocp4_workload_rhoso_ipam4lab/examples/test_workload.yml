---
# Example playbook for testing the ocp4_workload_rhoso_ipam4lab role
# This demonstrates how to use the role with the updated IPAM4Lab service

- name: Test RHOSO IPAM4Lab Workload
  hosts: localhost
  gather_facts: true
  vars:
    # Required variables
    ocp4_workload_rhoso_ipam4lab_service_url: "https://ipam4lab-ipam4lab.apps.cluster.example.com"
    ocp4_workload_rhoso_ipam4lab_cluster_name: "test-cluster"

    # Optional variables
    ocp4_workload_rhoso_ipam4lab_allocation_name: "rhoso-lab-{{ ansible_date_time.epoch }}"
    ocp4_workload_rhoso_ipam4lab_request_timeout: 30
    ocp4_workload_rhoso_ipam4lab_include_raw_response: true

    # Control variables
    ACTION: "create"  # Use "destroy" to deallocate
    silent: false
    become_override: false

  tasks:
    - name: Include the RHOSO IPAM4Lab workload role
      ansible.builtin.include_role:
        name: ocp4_workload_rhoso_ipam4lab

    - name: Display allocated information
      ansible.builtin.debug:
        msg:
          - "=== IPAM4Lab Allocation Complete ==="
          - "Allocation Name: {{ _ipam_allocation_name }}"
          - "Cluster: {{ _ipam_cluster_name }}"
          - "Network: {{ _ipam_subnet }} - {{ _ipam_network }}"
          - ""
          - "Worker IPs:"
          - "  EXTERNAL_IP_WORKER_1={{ _ipam_worker_ip_1 }}"
          - "  EXTERNAL_IP_WORKER_2={{ _ipam_worker_ip_2 }}"
          - "  EXTERNAL_IP_WORKER_3={{ _ipam_worker_ip_3 }}"
          - ""
          - "Infrastructure IPs:"
          - "  EXTERNAL_IP_BASTION={{ _ipam_bastion_ip }}"
          - "  CONVERSION_HOST_IP={{ _ipam_conversion_host_ip }}"
          - ""
          - "Public Network Range:"
          - "  PUBLIC_NET_START={{ _ipam_public_net_start }}"
          - "  PUBLIC_NET_END={{ _ipam_public_net_end }}"
          - "  (10 available IPs between start and end)"
          - ""
          - "Note: This allocation uses shared CIDR (192.168.0.0/16)"
          - "Same IPs can be allocated in different clusters"
